// 전시 데이터 정의
const exhibitionData = {
    'sensory-dissolution': {
        title: 'DISSOLUTION OF SENSES: 감각해체',
        period: '2025.07.01 - 2025.07.31',
        location: '아트코리아랩 미디어월',
        description: '단체전시 기획 및 작품 제작',
        fullDescription: '단체전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/sensory-dissolution/sensory_dissolution1.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution2.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution3.png',
            'exhibition-details/sensory-dissolution/sensory_dissolution4.png',
            'exhibition-details/sensory-dissolution/sensory_dissolution5.png',
            'exhibition-details/sensory-dissolution/sensory_dissolution6.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution7.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution8.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution9.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution10.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution11.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution12.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution13.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution14.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution15.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution16.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution17.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution18.jpeg'
        ],
        videos: [
            'exhibition-details/sensory-dissolution/sensory_dissolution_video.mp4'
        ]
    },
    'zip': {
        title: '.zip',
        period: '2025.05.26 - 2025.05.29',
        location: '경일대학교 12호관 1F',
        description: '학기말 전시 기획 및 작품 제작',
        fullDescription: '학기말 전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/zip/zipphoto1.jpg',
            'exhibition-details/zip/zipphoto2.jpeg',
            'exhibition-details/zip/zipphoto3.jpeg',
            'exhibition-details/zip/zipphoto4.jpeg',
            'exhibition-details/zip/zipphoto5.jpeg',
            'exhibition-details/zip/zipphoto6.jpeg',
            'exhibition-details/zip/zipphoto7.jpeg',
            'exhibition-details/zip/zipphoto8.jpeg',
            'exhibition-details/zip/zipphoto9.jpeg',
            'exhibition-details/zip/zipphoto10.jpeg',
            'exhibition-details/zip/zipphoto11.jpeg',
            'exhibition-details/zip/zipphoto12.jpeg',
            'exhibition-details/zip/zipphoto13.jpeg',
            'exhibition-details/zip/zipphoto14.jpeg',
            'exhibition-details/zip/zipphoto15.jpeg',
            'exhibition-details/zip/zipphoto16.jpg',
            'exhibition-details/zip/zipphoto17.JPG',
            'exhibition-details/zip/zipphoto18.jpeg',
            'exhibition-details/zip/zipphoto19.jpeg',
            'exhibition-details/zip/zipphoto20.jpeg',
            'exhibition-details/zip/zipphoto21.jpeg',
            'exhibition-details/zip/zipphoto22.jpeg',
            'exhibition-details/zip/zipphoto23.jpeg'
        ],
        videos: []
    },
    'clear-things': {
        title: '선명해져야 할 것들',
        period: '2024.12.20 - 2024.12.31',
        location: 'MOV.A(성미산로 888-11 5F)',
        description: '김다슬 교수님 전시 참여 및 작품 제작',
        fullDescription: '김다슬 교수님 전시 참여 및 작품 제작',
        photos: [
            'exhibition-details/clear-things/clear-things1.jpg',
            'exhibition-details/clear-things/clear-things2.jpg',
            'exhibition-details/clear-things/clear-things3.jpg',
            'exhibition-details/clear-things/clear-things4.jpg',
            'exhibition-details/clear-things/clear-things5.jpg',
            'exhibition-details/clear-things/clear-things6.jpg',
            'exhibition-details/clear-things/clear-things7.jpg',
            'exhibition-details/clear-things/clear-things8.jpg'
        ],
        videos: []
    },
    'sobok': {
        title: '소복',
        period: '2024.12.16 - 2024.12.20',
        location: '경일대학교 12호관 1F',
        description: '학기말 전시 기획 및 작품 제작',
        fullDescription: '학기말 전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/sobok/sobok_photo1.jpg',
            'exhibition-details/sobok/sobok_photo3.jpg',
            'exhibition-details/sobok/sobok_photo4.jpg',
            'exhibition-details/sobok/sobok_photo5.jpg',
            'exhibition-details/sobok/sobok_photo6.jpg',
            'exhibition-details/sobok/sobok_photo7.jpg',
            'exhibition-details/sobok/sobok_photo8.jpg',
            'exhibition-details/sobok/sobok_photo10_edited.jpg',
            'exhibition-details/sobok/sobok_photo11.jpg',
            'exhibition-details/sobok/sobok_photo12.jpg',
            'exhibition-details/sobok/sobok_photo13.jpg',
            'exhibition-details/sobok/sobok_photo14.jpg',
            'exhibition-details/sobok/sobok_group_photo.jpg',
            'exhibition-details/sobok/sobok_seungje.png',
            'exhibition-details/sobok/sobok_seunghun.png',
            'exhibition-details/sobok/sobok_additional_photo1.jpg',
            'exhibition-details/sobok/sobok_additional_photo2.jpg',
            'exhibition-details/sobok/sobok_additional_photo5.jpg',
            'exhibition-details/sobok/sobok_additional_photo6.jpg',
            'exhibition-details/sobok/sobok_additional_photo7.jpg'
        ],
        videos: []
    },
    'future-fragments': {
        title: '미래의 파편들',
        period: '2024.10.18 - 2024.11.10',
        location: '대구경북디자인센터 1F Media Wall',
        description: '교외 전시 작가로 참여 및 작품 제작',
        fullDescription: '교외 전시 작가로 참여 및 작품 제작',
        photos: [
            'exhibition-details/future-fragments/future_fragments_photo1_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo2_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo3_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo5_edited_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo6_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo7.jpg'
        ],
        videos: []
    },
    'mimyo': {
        title: '美, 묘하다',
        period: '2024.06.04 - 2024.06.10',
        location: '경일대학교 11호관 갤러리',
        description: '학기말 전시 기획 및 작품 제작',
        fullDescription: '학기말 전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/mimyo/mimyo_photo1.jpg',
            'exhibition-details/mimyo/mimyo_photo2.jpg',
            'exhibition-details/mimyo/mimyo_photo3.jpg',
            'exhibition-details/mimyo/mimyo_photo4.jpg',
            'exhibition-details/mimyo/mimyo_photo5.jpg',
            'exhibition-details/mimyo/mimyo_photo6.jpg'
        ],
        videos: []
    },
    'meta-festival': {
        title: 'GYEONGBUK META CONTENTS FESTIVAL',
        period: '2024.05.31 - 2024.06.02',
        location: '대구 EXCO 동관 1F HALL 6',
        description: '메타콘텐츠 학과 대표 전시 기획 및 작품 제작',
        fullDescription: '메타콘텐츠 학과 대표 전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/metacontents-festival/metacontents-composition.png',
            'exhibition-details/metacontents-festival/metacontents-photo1_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-photo2_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-photo3_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-photo4_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-photo5_edited_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-process_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-process2_edited.jpg'
        ],
        videos: []
    },
    'survival': {
        title: 'SURVIVAL',
        period: '2024.02.17 - 2024.02.25',
        location: '대구 중구 동덕로 30길 117 2F 아트스텔라 소노',
        description: '메타콘텐츠융합전공의 성과 보고회',
        fullDescription: '메타콘텐츠융합전공의 성과 보고회',
        photos: [
            'exhibition-details/SURVIVAL/survival_photo1.jpg',
            'exhibition-details/SURVIVAL/survival_photo2.jpg',
            'exhibition-details/SURVIVAL/survival_photo3.jpg',
            'exhibition-details/SURVIVAL/survival_photo4.jpg',
            'exhibition-details/SURVIVAL/survival_photo5.jpg',
            'exhibition-details/SURVIVAL/survival_photo6.jpg'
        ],
        videos: [
            'exhibition-details/SURVIVAL/survival_video2.mp4'
        ]
    }
};

// DOM이 로드된 후 실행
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM 로드 완료');
    
    // 로딩 표시
    const loadingElement = document.getElementById('loading');
    if (loadingElement) {
        loadingElement.style.display = 'flex';
    }
    
    // 필수 DOM 요소 확인
    const requiredElements = [
        'exhibitionTitle',
        'exhibitionPeriod', 
        'exhibitionLocation',
        'exhibitionDescription',
        'mediaContainer',
        'loading',
        'backBtn',
        'closeBtn'
    ];
    
    const missingElements = [];
    requiredElements.forEach(id => {
        const element = document.getElementById(id);
        if (!element) {
            missingElements.push(id);
        }
    });
    
    if (missingElements.length > 0) {
        console.error('필수 DOM 요소가 없습니다:', missingElements);
        return;
    }
    
    console.log('모든 필수 DOM 요소 확인 완료');
    
    // URL 파라미터에서 전시 ID 가져오기
    const urlParams = new URLSearchParams(window.location.search);
    const exhibitionId = urlParams.get('id') || urlParams.get('exhibition');
    
    console.log('URL 파라미터:', { id: urlParams.get('id'), exhibition: urlParams.get('exhibition') });
    console.log('선택된 전시 ID:', exhibitionId);
    
    if (exhibitionId && exhibitionData[exhibitionId]) {
        console.log('전시 데이터 찾음:', exhibitionId);
        loadExhibition(exhibitionId);
    } else {
        // 기본값으로 첫 번째 전시 로드
        const firstExhibitionId = Object.keys(exhibitionData)[0];
        console.log('기본 전시로 로드:', firstExhibitionId);
        loadExhibition(firstExhibitionId);
    }
    
    // 뒤로가기 버튼 이벤트
    const backBtn = document.getElementById('backBtn');
    backBtn.addEventListener('click', function() {
        window.history.back();
    });
    
    // 닫기 버튼 이벤트
    const closeBtn = document.getElementById('closeBtn');
    closeBtn.addEventListener('click', function() {
        window.history.back();
    });
    
    // ESC 키로 뒤로가기
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            window.history.back();
        }
    });
});

// 전시 로드 함수
function loadExhibition(exhibitionId) {
    console.log('전시 로드 시작:', exhibitionId);
    console.log('사용 가능한 전시:', Object.keys(exhibitionData));
    
    const data = exhibitionData[exhibitionId];
    if (!data) {
        console.error('전시 데이터를 찾을 수 없습니다:', exhibitionId);
        // 로딩 강제 해제
        const loadingElement = document.getElementById('loading');
        if (loadingElement) {
            loadingElement.style.display = 'none';
        }
        return;
    }
    
    console.log('전시 데이터:', data);
    
    // 헤더 정보 설정
    document.getElementById('exhibitionTitle').textContent = data.title;
    document.getElementById('exhibitionPeriod').textContent = data.period;
    document.getElementById('exhibitionLocation').textContent = data.location;
    
    // 전시 상세 설명 설정
    const descriptionElement = document.getElementById('exhibitionDescription');
    if (data.fullDescription) {
        descriptionElement.textContent = data.fullDescription;
        descriptionElement.style.display = 'block';
    } else {
        descriptionElement.style.display = 'none';
    }
    
    // 새로운 모던 갤러리 생성
    createModernExhibitionGallery(data);
}

// 새로운 모던 갤러리 생성 함수
function createModernExhibitionGallery(data) {
    console.log('새로운 모던 갤러리 생성 시작:', data.title);
    
    // 미디어 컨테이너 찾기
    const mediaContainer = document.getElementById('mediaContainer');
    if (!mediaContainer) {
        console.error('미디어 컨테이너를 찾을 수 없습니다');
        return;
    }
    
    // 모든 미디어 파일을 하나의 배열로 합치기
    const allMedia = [];
    
    // 사진 추가
    if (data.photos && data.photos.length > 0) {
        data.photos.forEach(photo => {
            allMedia.push({
                type: 'photo',
                src: photo,
                title: data.title
            });
        });
    }
    
    // 영상 추가
    if (data.videos && data.videos.length > 0) {
        data.videos.forEach(video => {
            allMedia.push({
                type: 'video',
                src: video,
                title: data.title
            });
        });
    }
    
    console.log('미디어 배열 생성 완료:', allMedia.length, '개 아이템');
    
    if (allMedia.length === 0) {
        mediaContainer.innerHTML = `
            <div class="modern-gallery">
                <div class="gallery-header">
                    <h2 class="gallery-title">미디어 없음</h2>
                    <p class="gallery-subtitle">표시할 미디어가 없습니다.</p>
                </div>
            </div>
        `;
        return;
    }
    
    // 새로운 모던 갤러리 HTML 구조 생성 (헤더 제거)
    mediaContainer.innerHTML = `
        <div class="modern-gallery">
            <div class="masonry-grid" id="masonry-container">
                <!-- 미디어 아이템들이 여기에 동적으로 추가됩니다 -->
            </div>
        </div>
    `;
    
    // 미디어 아이템들 생성
    createModernGalleryItems(allMedia);
    
    // 로딩 숨기기
    const loadingElement = document.getElementById('loading');
    if (loadingElement) {
        loadingElement.style.display = 'none';
    }
    
    console.log('새로운 모던 갤러리 생성 완료');
}

// 모던 갤러리 아이템들 생성 함수
function createModernGalleryItems(mediaArray) {
    const container = document.getElementById('masonry-container');
    if (!container) {
        console.error('마사지 컨테이너를 찾을 수 없습니다');
        return;
    }
    
    console.log('갤러리 아이템 생성 시작:', mediaArray.length, '개');
    
    mediaArray.forEach((media, index) => {
        const item = document.createElement('div');
        item.className = 'gallery-item';
        
        if (media.type === 'photo') {
            // 이미지 아이템 생성
            const img = document.createElement('img');
            img.src = media.src;
            img.alt = media.title;
            img.loading = 'lazy';
            
            img.onload = function() {
                console.log('이미지 로드 성공:', media.src);
            };
            
            img.onerror = function() {
                console.error('이미지 로드 실패:', media.src);
                item.innerHTML = `
                    <div class="loading-placeholder">
                        <div>
                            <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                            <div>이미지를 불러올 수 없습니다</div>
                        </div>
                    </div>
                `;
            };
            
            // 클릭 이벤트 추가
            item.addEventListener('click', function() {
                openModernLightbox(media.src, media.title, 'image');
            });
            
            item.appendChild(img);
            
        } else if (media.type === 'video') {
            // 비디오 아이템 생성
            const video = document.createElement('video');
            video.src = media.src;
            video.muted = true;
            video.playsInline = true;
            video.preload = 'metadata'; // 영상 메타데이터와 첫 프레임 로드
            
            // 1초 지점의 프레임을 썸네일로 사용
            video.currentTime = 1;
            
            // 비디오 오버레이 추가
            const overlay = document.createElement('div');
            overlay.className = 'video-overlay';
            overlay.innerHTML = '▶';
            
            video.onloadedmetadata = function() {
                console.log('비디오 로드 성공:', media.src);
                // 메타데이터 로드 후 1초 지점으로 이동
                video.currentTime = 1;
            };
            
            // 첫 번째 프레임을 빠르게 로드하기 위한 설정
            video.onloadeddata = function() {
                console.log('비디오 첫 프레임 로드 완료:', media.src);
            };
            
            video.onerror = function() {
                console.error('비디오 로드 실패:', media.src);
                item.innerHTML = `
                    <div class="loading-placeholder">
                        <div>
                            <div style="font-size: 48px; margin-bottom: 10px;">🎥</div>
                            <div>비디오를 불러올 수 없습니다</div>
                        </div>
                    </div>
                `;
            };
            
            // 클릭 이벤트 추가
            item.addEventListener('click', function() {
                openModernLightbox(media.src, media.title, 'video');
            });
            
            item.appendChild(video);
            item.appendChild(overlay);
        }
        
        container.appendChild(item);
        console.log(`갤러리 아이템 ${index + 1} 생성 완료:`, media.type);
    });
    
    console.log('모든 갤러리 아이템 생성 완료');
}

// 새로운 모던 라이트박스 함수
function openModernLightbox(src, title, type) {
    console.log('라이트박스 열기:', src, type);
    
    // 기존 라이트박스 제거
    const existingLightbox = document.querySelector('.modern-lightbox');
    if (existingLightbox) {
        existingLightbox.remove();
    }
    
    // 새로운 라이트박스 생성
    const lightbox = document.createElement('div');
    lightbox.className = 'modern-lightbox';
    
    const content = document.createElement('div');
    content.className = 'lightbox-content';
    
    if (type === 'image') {
        const img = document.createElement('img');
        img.src = src;
        img.alt = title;
        
        img.onload = function() {
            console.log('라이트박스 이미지 로드 성공');
        };
        
        img.onerror = function() {
            console.error('라이트박스 이미지 로드 실패');
            content.innerHTML = `
                <div style="color: white; text-align: center; padding: 50px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">📷</div>
                    <div>이미지를 불러올 수 없습니다</div>
                </div>
            `;
        };
        
        content.appendChild(img);
        
    } else if (type === 'video') {
        const video = document.createElement('video');
        video.src = src;
        video.controls = true;
        video.autoplay = true;
        video.muted = false;
        
        video.onloadedmetadata = function() {
            console.log('라이트박스 비디오 로드 성공');
        };
        
        video.onerror = function() {
            console.error('라이트박스 비디오 로드 실패');
            content.innerHTML = `
                <div style="color: white; text-align: center; padding: 50px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">🎥</div>
                    <div>비디오를 불러올 수 없습니다</div>
                </div>
            `;
        };
        
        content.appendChild(video);
    }
    
    // 닫기 버튼 추가
    const closeBtn = document.createElement('button');
    closeBtn.className = 'lightbox-close';
    closeBtn.innerHTML = '×';
    closeBtn.addEventListener('click', closeLightbox);
    
    content.appendChild(closeBtn);
    lightbox.appendChild(content);
    document.body.appendChild(lightbox);
    
    // 라이트박스 표시 애니메이션
    setTimeout(() => {
        lightbox.classList.add('active');
    }, 10);
    
    // 배경 클릭시 닫기
    lightbox.addEventListener('click', function(e) {
        if (e.target === lightbox) {
            closeLightbox();
        }
    });
    
    // ESC 키로 닫기
    const handleEscape = function(e) {
        if (e.key === 'Escape') {
            closeLightbox();
        }
    };
    document.addEventListener('keydown', handleEscape);
    
    function closeLightbox() {
        lightbox.classList.remove('active');
        setTimeout(() => {
            if (document.body.contains(lightbox)) {
                document.body.removeChild(lightbox);
            }
        }, 400);
        document.removeEventListener('keydown', handleEscape);
    }
}

// 배열을 랜덤하게 섞는 함수 (사용하지 않지만 호환성을 위해 유지)
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

// 전역 변수로 현재 슬라이드 상태 관리
let currentSlideIndex = 0;
let totalSlidesCount = 0;
let sliderContainerGlobal = null;

// 슬라이더 형식으로 미디어 아이템 생성
function createMediaItems(mediaArray, container) {
    console.log('createMediaItems 시작:', { mediaArrayLength: mediaArray.length, container: container });
    
    if (!container) {
        console.error('컨테이너가 없습니다');
        return;
    }
    
    // 전역 변수 초기화
    currentSlideIndex = 0;
    totalSlidesCount = mediaArray.length;
    
    // 컨테이너 스타일 설정
    container.style.height = 'calc(100vh - 200px)';
    container.style.minHeight = '500px';
    container.style.position = 'relative';
    container.style.overflow = 'hidden';
    container.style.backgroundColor = '#ffffff';
    
    console.log('컨테이너 스타일 설정 완료');
    
    // 슬라이더 컨테이너 생성
    const sliderContainer = document.createElement('div');
    sliderContainer.className = 'slider-container';
    sliderContainerGlobal = sliderContainer;
    
    sliderContainer.style.cssText = `
        display: flex;
        transition: transform 0.3s ease;
        height: 100%;
        width: ${mediaArray.length * 100}%;
        position: relative;
    `;
    
    console.log('슬라이더 컨테이너 생성:', { width: `${mediaArray.length * 100}%`, totalSlides: mediaArray.length });
    
    // 각 슬라이드 생성
    mediaArray.forEach((media, index) => {
        const slide = document.createElement('div');
        slide.className = 'slide-item';
        slide.style.cssText = `
            flex: 0 0 100%;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            background: transparent;
            overflow: visible;
        `;
        
        // 미디어 아이템 생성
        if (media.type === 'photo') {
            console.log('이미지 생성 중:', media.src);
            
            // 로딩 플레이스홀더 먼저 생성
            const loadingDiv = document.createElement('div');
            loadingDiv.style.cssText = `
                width: 100%;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #f8f8f8;
                color: #666;
                font-size: 14px;
            `;
            loadingDiv.innerHTML = `
                <div>
                    <div style="font-size: 24px; margin-bottom: 10px;">⏳</div>
                    <div>이미지 로딩 중...</div>
                </div>
            `;
            slide.appendChild(loadingDiv);
            
            // 이미지 생성 및 로드
            const img = document.createElement('img');
            img.style.cssText = `
                max-width: 90%;
                max-height: 80%;
                width: auto;
                height: auto;
                object-fit: contain;
                border-radius: 8px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                cursor: pointer;
                transition: transform 0.3s ease;
                display: block;
                visibility: visible;
                opacity: 1;
            `;
            
            img.onload = function() {
                console.log('이미지 로드 성공:', media.src);
                console.log('실제 로드된 URL:', this.src);
                console.log('이미지 크기:', this.naturalWidth, 'x', this.naturalHeight);
                
                // 로딩 플레이스홀더 제거하고 이미지 추가
                slide.removeChild(loadingDiv);
                slide.appendChild(img);
            };
            
            img.onerror = function() {
                console.error('이미지 로드 실패:', media.src);
                console.error('실제 시도된 URL:', this.src);
                
                // 로딩 플레이스홀더를 에러 메시지로 교체
                loadingDiv.innerHTML = `
                    <div>
                        <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                        <div>이미지를 불러올 수 없습니다</div>
                        <div style="font-size: 12px; margin-top: 10px;">${media.src.split('/').pop()}</div>
                    </div>
                `;
            };
            
            img.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('이미지 클릭됨:', media.src);
                openImageModal(encodeURI(media.src), media.title);
            });
            
            // 이미지 로드 시작
            img.src = media.src;
            img.alt = media.title;
            
        } else if (media.type === 'video') {
            const videoContainer = document.createElement('div');
            videoContainer.style.cssText = `
                position: relative;
                max-width: 90%;
                max-height: 80%;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                cursor: pointer;
            `;
            
            const video = document.createElement('video');
            video.src = media.src;
            video.muted = true;
            video.loop = true;
            video.playsInline = true;
            video.preload = 'metadata';
            video.controls = false;
            
            // 포스터 이미지 설정 (썸네일용)
            if (media.src.includes('sensory-dissolution')) {
                video.poster = 'exhibition-details/sensory-dissolution/sensory_dissolution1.jpeg';
            } else if (media.src.includes('SURVIVAL')) {
                video.poster = 'exhibition-details/SURVIVAL/survival_photo1.jpg';
            }
            video.style.cssText = `
                max-width: 100%;
                max-height: 100%;
                width: auto;
                height: auto;
                display: block;
                object-fit: contain;
            `;
            
            video.onerror = function() {
                console.log('비디오 로드 실패:', media.src);
                videoContainer.innerHTML = `
                    <div style="
                        width: 100%;
                        height: 200px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: #f5f5f5;
                        color: #666;
                        font-size: 14px;
                        text-align: center;
                    ">
                        <div>
                            <div style="font-size: 48px; margin-bottom: 10px;">🎥</div>
                            <div>비디오를 불러올 수 없습니다</div>
                        </div>
                    </div>
                `;
            };
            
            video.onloadedmetadata = function() {
                console.log('비디오 로드 성공:', media.src);
                // 메타데이터 로드 후 1초 지점으로 이동
                video.currentTime = 1;
            };
            
            // 재생 버튼 오버레이
            const playButton = document.createElement('div');
            playButton.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                width: 80px;
                height: 80px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2rem;
                cursor: pointer;
                transition: all 0.3s ease;
                z-index: 2;
            `;
            playButton.textContent = '▶';
            
            videoContainer.appendChild(video);
            videoContainer.appendChild(playButton);
            
            videoContainer.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('비디오 클릭됨:', media.src);
                openVideoModal(media.src, media.title);
            });
            
            slide.appendChild(videoContainer);
        }
        
        sliderContainer.appendChild(slide);
        console.log(`슬라이드 ${index + 1} 생성 완료:`, { mediaType: media.type, mediaSrc: media.src });
    });
    
    container.appendChild(sliderContainer);
    console.log('슬라이더 컨테이너 추가 완료');
    
    // 하단 미리보기 썸네일 추가
    addBottomThumbnailPreview(container, mediaArray);
    console.log('하단 썸네일 미리보기 추가 완료');
    
    // 네비게이션 컨트롤 추가
    addSliderControls(container, mediaArray.length);
    console.log('슬라이더 컨트롤 추가 완료');
    
    // 터치/마우스/스크롤 이벤트 추가
    addSliderEvents(sliderContainer, mediaArray.length);
    console.log('슬라이더 이벤트 추가 완료');
    
    // 로딩 숨기기
    const loadingElement = document.getElementById('loading');
    if (loadingElement) {
        loadingElement.style.display = 'none';
    }
}

// 슬라이드 아이템 생성 함수는 제거됨 - createMediaItems 함수 내에서 직접 처리

// 전역 슬라이더 위치 업데이트 함수
function updateSliderPosition(newIndex) {
    if (sliderContainerGlobal && newIndex >= 0 && newIndex < totalSlidesCount) {
        currentSlideIndex = newIndex;
        
        // 위치 계산 - 각 슬라이드가 전체 너비를 차지하므로 100%씩 이동
        const translateX = -(currentSlideIndex * 100);
        
        sliderContainerGlobal.style.transform = `translateX(${translateX}%)`;
        
        console.log('슬라이더 위치 업데이트:', { 
            index: currentSlideIndex, 
            translateX, 
            totalSlides: totalSlidesCount,
            containerWidth: sliderContainerGlobal.offsetWidth
        });
        
        // 인디케이터 업데이트
        const indicator = document.querySelector('.slider-indicator');
        if (indicator) {
            indicator.textContent = `${currentSlideIndex + 1} / ${totalSlidesCount}`;
        }
        
        // 썸네일 하이라이트 업데이트
        document.querySelectorAll('.bottom-thumbnail-item').forEach((item, i) => {
            item.style.borderColor = i === currentSlideIndex ? '#28eb25' : 'transparent';
        });
        
        // 선택된 썸네일을 화면 중앙으로 스크롤
        const selectedThumbnail = document.querySelectorAll('.bottom-thumbnail-item')[currentSlideIndex];
        if (selectedThumbnail) {
            const thumbnailContainer = selectedThumbnail.closest('.bottom-thumbnail-preview');
            if (thumbnailContainer) {
                const containerWidth = thumbnailContainer.offsetWidth;
                const thumbnailWidth = selectedThumbnail.offsetWidth;
                const thumbnailLeft = selectedThumbnail.offsetLeft;
                const scrollLeft = thumbnailLeft - (containerWidth / 2) + (thumbnailWidth / 2);
                
                thumbnailContainer.scrollTo({
                    left: scrollLeft,
                    behavior: 'smooth'
                });
            }
        }
        
        // 버튼 상태 업데이트
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');
        if (prevBtn && nextBtn) {
            prevBtn.disabled = currentSlideIndex === 0;
            nextBtn.disabled = currentSlideIndex === totalSlidesCount - 1;
            prevBtn.style.opacity = currentSlideIndex === 0 ? '0.5' : '1';
            nextBtn.style.opacity = currentSlideIndex === totalSlidesCount - 1 ? '0.5' : '1';
        }
    }
}

// 하단 썸네일 미리보기 추가 (아이폰 사진 앱 스타일)
function addBottomThumbnailPreview(container, mediaArray) {
    const thumbnailContainer = document.createElement('div');
    thumbnailContainer.className = 'bottom-thumbnail-preview';
    thumbnailContainer.style.cssText = `
        position: absolute;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 600px;
        height: 80px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 20px;
        padding: 10px;
        backdrop-filter: blur(10px);
        z-index: 100;
        display: flex;
        gap: 8px;
        overflow-x: auto;
        overflow-y: hidden;
        scrollbar-width: none;
        -ms-overflow-style: none;
        scroll-behavior: smooth;
    `;
    
    // 스크롤바 숨기기
    thumbnailContainer.style.webkitScrollbar = 'none';
    
    // 각 미디어의 썸네일 생성
    mediaArray.forEach((media, index) => {
        const thumbnail = document.createElement('div');
        thumbnail.className = 'bottom-thumbnail-item';
        thumbnail.style.cssText = `
            flex: 0 0 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            background: #333;
        `;
        
        if (media.type === 'photo') {
            const img = document.createElement('img');
            img.src = media.src;
            img.style.cssText = `
                width: 100%;
                height: 100%;
                object-fit: cover;
            `;
            img.onerror = function() {
                thumbnail.innerHTML = `
                    <div style="
                        width: 100%;
                        height: 100%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: #444;
                        color: #999;
                        font-size: 12px;
                    ">📷</div>
                `;
            };
            thumbnail.appendChild(img);
        } else if (media.type === 'video') {
            const video = document.createElement('video');
            video.src = media.src;
            video.muted = true;
            video.playsInline = true;
            video.preload = 'metadata'; // 영상 메타데이터와 첫 프레임 로드
            
            // 1초 지점의 프레임을 썸네일로 사용
            video.currentTime = 1;
            video.style.cssText = `
                width: 100%;
                height: 100%;
                object-fit: cover;
            `;
            
            // 비디오 썸네일 오버레이
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.4);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 14px;
            `;
            overlay.textContent = '▶';
            
            thumbnail.appendChild(video);
            thumbnail.appendChild(overlay);
        }
        
        // 썸네일 클릭 이벤트
        thumbnail.addEventListener('click', function() {
            // 전역 함수를 사용하여 슬라이더 위치 업데이트
            updateSliderPosition(index);
        });
        
        // 첫 번째 썸네일 하이라이트
        if (index === 0) {
            thumbnail.style.borderColor = '#28eb25';
        }
        
        thumbnailContainer.appendChild(thumbnail);
    });
    
    container.appendChild(thumbnailContainer);
}

// 미디어 아이템 생성 (기존 함수는 유지하되 슬라이더용으로 별도 처리)
function createMediaItem(media, index) {
    const item = document.createElement('div');
    item.className = `media-item ${media.type}-item`;
    
    if (media.type === 'photo') {
        const img = document.createElement('img');
        img.src = media.src;
        img.alt = media.title;
        img.loading = 'lazy';
        
        img.onerror = function() {
            console.log('이미지 로드 실패:', media.src);
            item.innerHTML = `
                <div style="
                    width: 100%;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background: #f5f5f5;
                    color: #666;
                    font-size: 12px;
                    text-align: center;
                    padding: 10px;
                    border: 1px solid #ddd;
                ">
                    <div>
                        <div style="font-size: 24px; margin-bottom: 5px;">📷</div>
                        <div>이미지를 불러올 수 없습니다</div>
                        <div style="font-size: 10px; margin-top: 5px;">${media.src.split('/').pop()}</div>
                    </div>
                </div>
            `;
        };
        
        img.onload = function() {
            console.log('이미지 로드 성공:', media.src);
        };
        
        item.appendChild(img);
        
        item.addEventListener('click', function() {
            openImageModal(encodeURI(media.src), media.title);
        });
        
    } else if (media.type === 'video') {
        const video = document.createElement('video');
        video.src = media.src;
        video.muted = true;
        video.loop = true;
        video.playsInline = true;
        video.preload = 'metadata'; // 영상 메타데이터와 첫 프레임 로드
        
        video.onerror = function() {
            console.log('비디오 로드 실패:', media.src);
            item.style.display = 'none';
        };
        
        video.onloadedmetadata = function() {
            console.log('비디오 로드 성공:', media.src);
            // 메타데이터 로드 후 1초 지점으로 이동
            video.currentTime = 1;
        };
        
        item.appendChild(video);
        
        item.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openVideoModal(media.src, media.title);
        });
        
        item.addEventListener('mouseenter', function() {
            video.play().then(() => {
                item.style.setProperty('--play-icon-opacity', '0');
            }).catch(error => {
                console.log('비디오 자동 재생 실패:', error);
            });
        });
        
        item.addEventListener('mouseleave', function() {
            video.pause();
            item.style.setProperty('--play-icon-opacity', '1');
        });
        
        item.addEventListener('touchstart', function(e) {
            e.preventDefault();
            openVideoModal(encodeURI(media.src), media.title);
        });
    }
    
    return item;
}

// 슬라이더 컨트롤 추가
function addSliderControls(container, totalSlides) {
    console.log('addSliderControls 시작:', { totalSlides, container });
    
    if (!container) {
        console.error('컨테이너가 없습니다');
        return;
    }
    
    // 네비게이션 컨테이너
    const navContainer = document.createElement('div');
    navContainer.className = 'slider-nav';
    navContainer.style.cssText = `
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 100;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px 15px;
        border-radius: 25px;
        backdrop-filter: blur(10px);
    `;
    
    // 이전/다음 버튼
    const prevBtn = document.createElement('button');
    prevBtn.innerHTML = '‹';
    prevBtn.className = 'slider-btn prev-btn';
    prevBtn.style.cssText = `
        background: rgba(40, 235, 37, 0.9);
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    `;
    
    const nextBtn = document.createElement('button');
    nextBtn.innerHTML = '›';
    nextBtn.className = 'slider-btn next-btn';
    nextBtn.style.cssText = prevBtn.style.cssText;
    
    // 페이지 인디케이터
    const indicator = document.createElement('div');
    indicator.className = 'slider-indicator';
    indicator.style.cssText = `
        background: rgba(255, 255, 255, 0.9);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
        color: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 80px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    `;
    indicator.textContent = `1 / ${totalSlides}`;
    
    navContainer.appendChild(prevBtn);
    navContainer.appendChild(indicator);
    navContainer.appendChild(nextBtn);
    container.appendChild(navContainer);
    
    // 버튼 이벤트
    prevBtn.addEventListener('click', function() {
        if (currentSlideIndex > 0) {
            updateSliderPosition(currentSlideIndex - 1);
        }
    });
    
    nextBtn.addEventListener('click', function() {
        if (currentSlideIndex < totalSlides - 1) {
            updateSliderPosition(currentSlideIndex + 1);
        }
    });
    
    // 키보드 이벤트
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft' && currentSlideIndex > 0) {
            updateSliderPosition(currentSlideIndex - 1);
        } else if (e.key === 'ArrowRight' && currentSlideIndex < totalSlides - 1) {
            updateSliderPosition(currentSlideIndex + 1);
        }
    });
    
    // 버튼 상태 업데이트 함수
    function updateButtonStates() {
        prevBtn.disabled = currentSlideIndex === 0;
        nextBtn.disabled = currentSlideIndex === totalSlides - 1;
        prevBtn.style.opacity = currentSlideIndex === 0 ? '0.5' : '1';
        nextBtn.style.opacity = currentSlideIndex === totalSlides - 1 ? '0.5' : '1';
    }
    
    // 초기 상태 설정
    updateButtonStates();
}

// 슬라이더 터치/마우스 이벤트
function addSliderEvents(sliderContainer, totalSlides) {
    let startX = 0;
    let currentX = 0;
    let isDragging = false;
    
    function handleStart(e) {
        // 이미지나 비디오를 클릭한 경우 드래그 시작하지 않음
        if (e.target.tagName === 'IMG' || e.target.tagName === 'VIDEO' || e.target.closest('.video-container')) {
            return;
        }
        
        isDragging = true;
        startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
        sliderContainer.style.transition = 'none';
        console.log('드래그 시작:', { startX, isDragging });
    }
    
    function handleMove(e) {
        if (!isDragging) return;
        
        e.preventDefault();
        currentX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
        const diff = currentX - startX;
        
        // 드래그 계산 - 각 슬라이드가 100% 너비를 차지하므로
        const containerWidth = sliderContainer.offsetWidth;
        const translateX = -(currentSlideIndex * 100) + (diff / containerWidth * 100);
        
        sliderContainer.style.transform = `translateX(${translateX}%)`;
        
        console.log('드래그 중:', { diff, translateX, currentSlideIndex, containerWidth });
    }
    
    function handleEnd() {
        if (!isDragging) return;
        
        isDragging = false;
        if (sliderContainer) {
            sliderContainer.style.transition = 'transform 0.3s ease';
            
            const diff = currentX - startX;
            const threshold = sliderContainer.offsetWidth * 0.15; // 임계값을 낮춤
            
            console.log('드래그 종료:', { diff, threshold, currentSlideIndex, totalSlides });
            
            if (Math.abs(diff) > threshold) {
                if (diff > 0 && currentSlideIndex > 0) {
                    // 오른쪽으로 드래그 = 이전 슬라이드
                    updateSliderPosition(currentSlideIndex - 1);
                } else if (diff < 0 && currentSlideIndex < totalSlides - 1) {
                    // 왼쪽으로 드래그 = 다음 슬라이드
                    updateSliderPosition(currentSlideIndex + 1);
                } else {
                    // 슬라이드가 변경되지 않은 경우 현재 위치로 복원
                    updateSliderPosition(currentSlideIndex);
                }
            } else {
                // 슬라이드가 변경되지 않은 경우 현재 위치로 복원
                updateSliderPosition(currentSlideIndex);
            }
        }
    }
    
    // 마우스 이벤트
    sliderContainer.addEventListener('mousedown', handleStart, { passive: false });
    document.addEventListener('mousemove', handleMove, { passive: false });
    document.addEventListener('mouseup', handleEnd, { passive: false });
    
    // 터치 이벤트
    sliderContainer.addEventListener('touchstart', handleStart, { passive: false });
    sliderContainer.addEventListener('touchmove', handleMove, { passive: false });
    sliderContainer.addEventListener('touchend', handleEnd, { passive: false });
    
    // 스크롤 이벤트 (마우스 휠)
    sliderContainer.addEventListener('wheel', function(e) {
        e.preventDefault();
        
        if (e.deltaY > 0 && currentSlideIndex < totalSlides - 1) {
            // 아래로 스크롤 = 다음 슬라이드
            updateSliderPosition(currentSlideIndex + 1);
        } else if (e.deltaY < 0 && currentSlideIndex > 0) {
            // 위로 스크롤 = 이전 슬라이드
            updateSliderPosition(currentSlideIndex - 1);
        }
    });
}



// 이미지 확대 모달
function openImageModal(imageSrc, imageTitle) {
    console.log('이미지 모달 열기:', imageSrc);
    
    const modal = document.createElement('div');
    modal.className = 'image-modal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        opacity: 0;
        transition: opacity 0.3s ease;
        cursor: pointer;
    `;
    
    const img = document.createElement('img');
    img.src = imageSrc;
    img.alt = imageTitle;
    img.style.cssText = `
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        cursor: pointer;
    `;
    
    // 이미지 로드 실패 시 처리
    img.onerror = function() {
        console.log('모달 이미지 로드 실패:', imageSrc);
        modal.innerHTML = `
            <div style="
                color: white;
                text-align: center;
                padding: 20px;
            ">
                <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                <div>이미지를 불러올 수 없습니다</div>
                <div style="font-size: 12px; margin-top: 10px;">${imageSrc.split('/').pop()}</div>
            </div>
        `;
    };
    
    modal.appendChild(img);
    document.body.appendChild(modal);
    
    // 애니메이션 시작
    setTimeout(() => {
        modal.style.opacity = '1';
    }, 10);
    
    // 클릭 시 닫기
    modal.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('모달 닫기');
        modal.style.opacity = '0';
        setTimeout(() => {
            if (document.body.contains(modal)) {
                document.body.removeChild(modal);
            }
        }, 300);
    });
    
    // ESC 키로 닫기
    const closeOnEscape = function(e) {
        if (e.key === 'Escape') {
            console.log('ESC 키로 모달 닫기');
            modal.style.opacity = '0';
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    document.body.removeChild(modal);
                }
            }, 300);
            document.removeEventListener('keydown', closeOnEscape);
        }
    };
    document.addEventListener('keydown', closeOnEscape);
}

// 영상 확대 모달
function openVideoModal(videoSrc, videoTitle) {
    const modal = document.createElement('div');
    modal.className = 'video-modal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        opacity: 0;
        transition: opacity 0.3s ease;
    `;
    
    const videoContainer = document.createElement('div');
    videoContainer.style.cssText = `
        max-width: 90%;
        max-height: 90%;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        position: relative;
    `;
    
    const video = document.createElement('video');
    video.src = encodeURI(videoSrc);
    video.controls = true;
    video.autoplay = true;
    video.muted = false;
    video.loop = true;
    video.playsInline = true;
    video.style.cssText = `
        width: 100%;
        height: auto;
        max-height: 90vh;
        display: block;
        background: #000;
        filter: brightness(1.2) contrast(1.1);
    `;
    
    // 비디오 로드 실패 시 처리
    video.onerror = function() {
        console.log('비디오 모달 로드 실패:', videoSrc);
        modal.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(modal);
        }, 300);
    };
    
    videoContainer.appendChild(video);
    modal.appendChild(videoContainer);
    document.body.appendChild(modal);
    
    // 애니메이션 시작
    setTimeout(() => {
        modal.style.opacity = '1';
    }, 10);
    
    // 비디오 자동 재생
    video.play().catch(error => {
        console.log('비디오 모달 자동 재생 실패:', error);
    });
    
    // 클릭 시 닫기 (비디오 영역 제외)
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            video.pause();
            modal.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(modal);
            }, 300);
        }
    });
    
    // ESC 키로 닫기
    const closeOnEscape = function(e) {
        if (e.key === 'Escape') {
            video.pause();
            modal.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(modal);
            }, 300);
            document.removeEventListener('keydown', closeOnEscape);
        }
    };
    document.addEventListener('keydown', closeOnEscape);
}

// 윈도우 리사이즈 시 슬라이더 조정
window.addEventListener('resize', function() {
    const mediaContainer = document.getElementById('mediaContainer');
    const sliderContainer = mediaContainer.querySelector('.slider-container');
    
    if (sliderContainer) {
        const containerHeight = Math.max(500, window.innerHeight - 200);
        mediaContainer.style.height = containerHeight + 'px';
        mediaContainer.style.minHeight = '500px';
        
        // 슬라이더 컨테이너 너비 재조정
        const slideItems = sliderContainer.querySelectorAll('.slide-item');
        sliderContainer.style.width = `${slideItems.length * 100}%`;
        
        // 각 슬라이드 아이템 너비 재조정
        slideItems.forEach(slide => {
            slide.style.flex = `0 0 ${100 / slideItems.length}%`;
        });
    }
});

// 페이지 가시성 변경 시 비디오 제어
document.addEventListener('visibilitychange', function() {
    const videos = document.querySelectorAll('video');
    
    if (document.hidden) {
        videos.forEach(video => {
            video.pause();
        });
    }
});

// 페이지 로드 완료 후 초기화
window.addEventListener('load', function() {
    console.log('페이지 로드 완료');
    
    // 로딩 숨기기 (최종 보장)
    const loadingElement = document.getElementById('loading');
    if (loadingElement) {
        loadingElement.style.display = 'none';
    }
});
