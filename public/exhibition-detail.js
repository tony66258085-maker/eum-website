// 전시 데이터 정의
const exhibitionData = {
    'sensory-dissolution': {
        title: 'DISSOLUTION OF SENSES: 감각해체',
        period: '2025.07.01 - 2025.07.31',
        location: '아트코리아랩 미디어월',
        description: '단체전시 기획 및 작품 제작',
        fullDescription: '단체전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/sensory-dissolution/sensory_dissolution1.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution2.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution3.png',
            'exhibition-details/sensory-dissolution/sensory_dissolution4.png',
            'exhibition-details/sensory-dissolution/sensory_dissolution5.png',
            'exhibition-details/sensory-dissolution/sensory_dissolution6.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution7.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution8.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution9.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution10.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution11.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution12.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution13.jpeg',
            'exhibition-details/sensory-dissolution/sensory_dissolution14.jpeg',
        ],
        videos: ['exhibition-details/sensory-dissolution/sensory_dissolution_video.mov']
    },
    'zip': {
        title: '.zip',
        period: '2025.05.26 - 2025.05.29',
        location: '경일대학교 12호관 1F',
        description: '학기말 전시 기획 및 작품 제작',
        fullDescription: '학기말 전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/zip/zipphoto1.jpg',
            'exhibition-details/zip/zipphoto2.jpeg',
            'exhibition-details/zip/zipphoto3.jpeg',
            'exhibition-details/zip/zipphoto4.jpeg',
            'exhibition-details/zip/zipphoto5.jpeg',
            'exhibition-details/zip/zipphoto6.jpeg',
            'exhibition-details/zip/zipphoto7.jpeg',
            'exhibition-details/zip/zipphoto8.jpeg',
            'exhibition-details/zip/zipphoto9.jpeg',
            'exhibition-details/zip/zipphoto10.jpeg',
            'exhibition-details/zip/zipphoto11.jpeg',
            'exhibition-details/zip/zipphoto12.jpeg',
            'exhibition-details/zip/zipphoto13.jpeg',
            'exhibition-details/zip/zipphoto14.jpeg',
            'exhibition-details/zip/zipphoto15.jpeg',
            'exhibition-details/zip/zipphoto16.jpg',
            'exhibition-details/zip/zipphoto19.jpeg',
            'exhibition-details/zip/zipphoto20.jpeg',
            'exhibition-details/zip/zipphoto21.jpeg',
            'exhibition-details/zip/zipphoto22.jpeg',
            'exhibition-details/zip/zipphoto23.jpeg',
        ],
        videos: []
    },
    'clear-things': {
        title: '선명해져야 할 것들',
        period: '2024.12.20 - 2024.12.31',
        location: 'MOV.A(성미산로 888-11 5F)',
        description: '김다슬 교수님 전시 참여 및 작품 제작',
        fullDescription: '김다슬 교수님 전시 참여 및 작품 제작',
        photos: [
            'exhibition-details/clear-things/clear-things1.jpg',
            'exhibition-details/clear-things/clear-things2.jpg',
            'exhibition-details/clear-things/clear-things3.jpg',
            'exhibition-details/clear-things/clear-things4.jpg',
            'exhibition-details/clear-things/clear-things5.jpg',
            'exhibition-details/clear-things/clear-things6.jpg',
            'exhibition-details/clear-things/clear-things7.jpg',
            'exhibition-details/clear-things/clear-things8.jpg'
        ],
        videos: []
    },
    'sobok': {
        title: '소복',
        period: '2024.12.16 - 2024.12.20',
        location: '경일대학교 12호관 1F',
        description: '학기말 전시 기획 및 작품 제작',
        fullDescription: '학기말 전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/sobok/sobok_group_photo.jpg',
            'exhibition-details/sobok/sobok_photo1.jpg',
            'exhibition-details/sobok/sobok_photo10_edited.jpg',
            'exhibition-details/sobok/sobok_photo11.jpg',
            'exhibition-details/sobok/sobok_photo12.jpg',
            'exhibition-details/sobok/sobok_photo13.jpg',
            'exhibition-details/sobok/sobok_photo14.jpg',
            'exhibition-details/sobok/sobok_photo3.jpg',
            'exhibition-details/sobok/sobok_photo4.jpg',
            'exhibition-details/sobok/sobok_photo5.jpg',
            'exhibition-details/sobok/sobok_photo6.jpg',
            'exhibition-details/sobok/sobok_photo7.jpg',
            'exhibition-details/sobok/sobok_photo8.jpg',
            'exhibition-details/sobok/sobok_seungje.png',
            'exhibition-details/sobok/sobok_seunghun.png',
            'exhibition-details/sobok/sobok_additional_photo1.jpg',
            'exhibition-details/sobok/sobok_additional_photo2.jpg',
            'exhibition-details/sobok/sobok_additional_photo5.jpg',
            'exhibition-details/sobok/sobok_additional_photo6.jpg',
            'exhibition-details/sobok/sobok_additional_photo7.jpg'
        ],
        videos: []
    },
    'future-fragments': {
        title: '미래의 파편들',
        period: '2024.10.18 - 2024.11.10',
        location: '대구경북디자인센터 1F Media Wall',
        description: '교외 전시 작가로 참여 및 작품 제작',
        fullDescription: '교외 전시 작가로 참여 및 작품 제작',
        photos: [
            'exhibition-details/future-fragments/future_fragments_photo1_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo2_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo3_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo5_edited_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo6_edited.jpg',
            'exhibition-details/future-fragments/future_fragments_photo7.jpg'
        ],
        videos: []
    },
    'mimyo': {
        title: '美, 묘하다',
        period: '2024.06.04 - 2024.06.10',
        location: '경일대학교 11호관 갤러리',
        description: '학기말 전시 기획 및 작품 제작',
        fullDescription: '학기말 전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/mimyo/mimyo_photo1.jpg',
            'exhibition-details/mimyo/mimyo_photo2.jpg',
            'exhibition-details/mimyo/mimyo_photo3.jpg',
            'exhibition-details/mimyo/mimyo_photo4.jpg',
            'exhibition-details/mimyo/mimyo_photo5.jpg',
            'exhibition-details/mimyo/mimyo_photo6.jpg'
        ],
        videos: []
    },
    'meta-festival': {
        title: 'GYEONGBUK META CONTENTS FESTIVAL',
        period: '2024.05.31 - 2024.06.02',
        location: '대구 EXCO 동관 1F HALL 6',
        description: '메타콘텐츠 학과 대표 전시 기획 및 작품 제작',
        fullDescription: '메타콘텐츠 학과 대표 전시 기획 및 작품 제작',
        photos: [
            'exhibition-details/metacontents-festival/metacontents-composition.png',
            'exhibition-details/metacontents-festival/metacontents-photo1_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-photo2_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-photo3_edited.png',
            'exhibition-details/metacontents-festival/metacontents-photo4_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-photo5_edited_edited.jpg',
            'exhibition-details/metacontents-festival/metacontents-work-process_edited.png',
            'exhibition-details/metacontents-festival/metacontents-work-process2_edited.jpg'
        ],
        videos: []
    },
    'survival': {
        title: 'SURVIVAL',
        period: '2024.02.17 - 2024.02.25',
        location: '대구 중구 동덕로 30길 117 2F 아트스텔라 소노',
        description: '메타콘텐츠융합전공의 성과 보고회',
        fullDescription: '메타콘텐츠융합전공의 성과 보고회',
        photos: [
            'exhibition-details/SURVIVAL/survival_photo1.png',
            'exhibition-details/SURVIVAL/survival_photo2.png',
            'exhibition-details/SURVIVAL/survival_photo3.png',
            'exhibition-details/SURVIVAL/survival_photo4.png',
            'exhibition-details/SURVIVAL/survival_photo5.png',
            'exhibition-details/SURVIVAL/survival_photo6.png'
        ],
        videos: [
            'exhibition-details/SURVIVAL/survival_video2.mp4'
        ]
    }
};

// 웹사이트 보안 설정
function disableDeveloperTools() {
    // 개발자 도구 단축키 비활성화
    document.addEventListener('keydown', function(e) {
        // F12 키 비활성화
        if (e.key === 'F12') {
            e.preventDefault();
            return false;
        }
        
        // Ctrl+Shift+I (개발자 도구) 비활성화
        if (e.ctrlKey && e.shiftKey && e.key === 'I') {
            e.preventDefault();
            return false;
        }
        
        // Ctrl+Shift+J (콘솔) 비활성화
        if (e.ctrlKey && e.shiftKey && e.key === 'J') {
            e.preventDefault();
            return false;
        }
        
        // Ctrl+U (소스 보기) 비활성화
        if (e.ctrlKey && e.key === 'u') {
            e.preventDefault();
            return false;
        }
        
        // Ctrl+Shift+C (요소 검사) 비활성화
        if (e.ctrlKey && e.shiftKey && e.key === 'C') {
            e.preventDefault();
            return false;
        }
    });
    
    // 우클릭 메뉴 비활성화 (데스크톱에서만)
    if (!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
    }
    
    // 드래그 선택 비활성화
    document.addEventListener('selectstart', function(e) {
        e.preventDefault();
        return false;
    });
    
    // 개발자 도구 감지 (데스크톱에서만 작동)
    if (!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        let devtools = {
            open: false,
            orientation: null
        };
        
        setInterval(function() {
            const threshold = 160;
            const widthThreshold = window.outerWidth - window.innerWidth > threshold;
            const heightThreshold = window.outerHeight - window.innerHeight > threshold;
            
            if (widthThreshold || heightThreshold) {
                if (!devtools.open) {
                    devtools.open = true;
                    // 개발자 도구가 열렸을 때 페이지 리다이렉트
                    window.location.href = 'about:blank';
                }
            } else {
                devtools.open = false;
            }
        }, 500);
    }
}

// DOM이 로드된 후 실행
document.addEventListener('DOMContentLoaded', function() {
    disableDeveloperTools();
    // URL 파라미터에서 전시 ID 가져오기
    const urlParams = new URLSearchParams(window.location.search);
    const exhibitionId = urlParams.get('id');
    
    if (exhibitionId && exhibitionData[exhibitionId]) {
        loadExhibition(exhibitionId);
    } else {
        // 기본값으로 첫 번째 전시 로드
        const firstExhibitionId = Object.keys(exhibitionData)[0];
        loadExhibition(firstExhibitionId);
    }
    
    // 뒤로가기 버튼 이벤트
    const backBtn = document.getElementById('backBtn');
    backBtn.addEventListener('click', function() {
        window.history.back();
    });
    
    // 닫기 버튼 이벤트
    const closeBtn = document.getElementById('closeBtn');
    closeBtn.addEventListener('click', function() {
        window.history.back();
    });
    
    // ESC 키로 뒤로가기
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            window.history.back();
        }
    });

    // 도메인별 메타 태그 설정
    updateMetaTags();
});

// 전시 로드 함수
function loadExhibition(exhibitionId) {
    const data = exhibitionData[exhibitionId];
    if (!data) return;
    
    // 헤더 정보 설정
    document.getElementById('exhibitionTitle').textContent = data.title;
    document.getElementById('exhibitionPeriod').textContent = data.period;
    document.getElementById('exhibitionLocation').textContent = data.location;
    
    // 전시 상세 설명 설정
    const descriptionElement = document.getElementById('exhibitionDescription');
    if (data.fullDescription) {
        descriptionElement.textContent = data.fullDescription;
        descriptionElement.style.display = 'block';
    } else {
        descriptionElement.style.display = 'none';
    }
    
    // 미디어 컨테이너 초기화
    const mediaContainer = document.getElementById('mediaContainer');
    mediaContainer.innerHTML = '';
    
    // 모든 미디어 파일을 하나의 배열로 합치기
    const allMedia = [];
    
    // 사진 추가
    data.photos.forEach(photo => {
        allMedia.push({
            type: 'photo',
            src: photo,
            title: data.title
        });
    });
    
    // 영상 추가
    data.videos.forEach(video => {
        allMedia.push({
            type: 'video',
            src: video,
            title: data.title
        });
    });
    
    // 미디어 순서를 랜덤하게 섞기
    shuffleArray(allMedia);
    
    // 미디어 아이템 생성 및 배치
    createMediaItems(allMedia, mediaContainer);
    
    // 로딩 숨기기 - 모바일에서는 더 빠르게
    const isMobile = window.innerWidth <= 768;
    const loadingTime = isMobile ? 500 : 1000;
    
    // 로딩 타임아웃 설정 (최대 5초)
    const loadingTimeout = setTimeout(() => {
        const loadingElement = document.getElementById('loading');
        if (loadingElement && !loadingElement.classList.contains('hidden')) {
            loadingElement.classList.add('hidden');
            console.log('로딩 타임아웃으로 강제 종료');
        }
    }, 5000);
    
    setTimeout(() => {
        const loadingElement = document.getElementById('loading');
        if (loadingElement) {
            loadingElement.classList.add('hidden');
            clearTimeout(loadingTimeout);
        }
    }, loadingTime);
}

// 배열을 랜덤하게 섞는 함수
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

// 미디어 아이템 생성 및 배치 (마인드맵 스타일)
function createMediaItems(mediaArray, container) {
    const containerWidth = container.offsetWidth;
    const containerHeight = Math.max(800, window.innerHeight - 200);
    
    // 모바일에서 더 많은 높이 확보
    const isMobile = window.innerWidth <= 768;
    const adjustedHeight = isMobile ? containerHeight + 300 : containerHeight;
    
    // 컨테이너 높이 설정
    container.style.height = adjustedHeight + 'px';
    
    // 중앙점 계산
    const centerX = containerWidth / 2;
    const centerY = containerHeight / 2;
    
    // 마인드맵 배치를 위한 설정
    const itemCount = mediaArray.length;
    
    // 아이템 개수에 따라 배치 전략 결정
    let placementStrategy;
    if (itemCount <= 8) {
        // 8개 이하: 마인드맵 스타일
        placementStrategy = 'mindmap';
        const baseRadius = isMobile ? 150 : 200;
        const maxRadius = isMobile ? 350 : 500;
        
        mediaArray.forEach((media, index) => {
            const item = createMediaItem(media, index);
            const size = getRandomSize();
            
            // 마인드맵 위치 계산 (중앙에서 방사형으로)
            const angle = (index / itemCount) * 2 * Math.PI + (Math.random() - 0.5) * 0.3;
            const radius = baseRadius + Math.random() * (maxRadius - baseRadius);
            
            // 극좌표를 직교좌표로 변환
            const x = centerX + Math.cos(angle) * radius - size.width / 2;
            const y = centerY + Math.sin(angle) * radius - size.height / 2;
            
            // 화면 경계 내에 위치하도록 조정
            const margin = isMobile ? 40 : 20;
            const adjustedX = Math.max(margin, Math.min(containerWidth - size.width - margin, x));
            const adjustedY = Math.max(margin, Math.min(containerHeight - size.height - margin, y));
            
            // 아이템 스타일 설정
            item.style.width = size.width + 'px';
            item.style.height = size.height + 'px';
            item.style.left = adjustedX + 'px';
            item.style.top = adjustedY + 'px';
            
            // 애니메이션 지연 설정
            const distanceFromCenter = Math.sqrt((adjustedX - centerX) ** 2 + (adjustedY - centerY) ** 2);
            const maxDistance = Math.sqrt((containerWidth / 2) ** 2 + (containerHeight / 2) ** 2);
            const delay = (distanceFromCenter / maxDistance) * 0.5 + (index * 0.05);
            item.style.animationDelay = delay + 's';
            
            container.appendChild(item);
        });
    } else {
        // 8개 초과: 모바일에서는 더 자연스러운 배치
        placementStrategy = 'grid';
        const isSmallMobile = window.innerWidth <= 480;
        
        if (isMobile) {
            // 모바일에서는 3열 그리드로 배치하되 더 넓은 공간
            const cols = 3;
            const rows = Math.ceil(itemCount / cols);
            const cellWidth = (containerWidth - 60) / cols; // 더 넓은 여백
            const cellHeight = (containerHeight - 60) / rows;
            
            mediaArray.forEach((media, index) => {
                const item = createMediaItem(media, index);
                const size = getRandomSize();
                
                // 그리드 위치 계산
                const col = index % cols;
                const row = Math.floor(index / cols);
                
                // 셀 내에서 랜덤한 위치 (더 넓은 범위)
                const cellX = col * cellWidth + 30;
                const cellY = row * cellHeight + 30;
                
                // 셀 내에서 랜덤 오프셋 (더 넓은 범위)
                const maxOffsetX = Math.max(0, cellWidth - size.width - 20);
                const maxOffsetY = Math.max(0, cellHeight - size.height - 20);
                const offsetX = Math.random() * maxOffsetX;
                const offsetY = Math.random() * maxOffsetY;
                
                const finalX = cellX + offsetX;
                const finalY = cellY + offsetY;
                
                // 약간의 회전 추가
                const rotation = (Math.random() - 0.5) * 15;
                item.style.transform = `rotate(${rotation}deg)`;
                
                // 아이템 스타일 설정
                item.style.width = size.width + 'px';
                item.style.height = size.height + 'px';
                item.style.left = finalX + 'px';
                item.style.top = finalY + 'px';
                
                // 애니메이션 지연 설정
                const delay = (index * 0.05) + (Math.random() * 0.2);
                item.style.animationDelay = delay + 's';
                
                container.appendChild(item);
            });
        } else {
            // 데스크톱에서는 기존 그리드 방식
            const cols = 6;
            const rows = Math.ceil(itemCount / cols);
            const cellWidth = (containerWidth - 40) / cols;
            const cellHeight = (containerHeight - 40) / rows;
            
            mediaArray.forEach((media, index) => {
                const item = createMediaItem(media, index);
                const size = getRandomSize();
                
                // 그리드 위치 계산
                const col = index % cols;
                const row = Math.floor(index / cols);
                
                // 셀 내에서 랜덤한 위치
                const cellX = col * cellWidth + 20;
                const cellY = row * cellHeight + 20;
                
                // 셀 내에서 랜덤 오프셋
                const maxOffsetX = Math.max(0, cellWidth - size.width - 20);
                const maxOffsetY = Math.max(0, cellHeight - size.height - 20);
                const offsetX = Math.random() * maxOffsetX;
                const offsetY = Math.random() * maxOffsetY;
                
                const finalX = cellX + offsetX;
                const finalY = cellY + offsetY;
                
                // 아이템 스타일 설정
                item.style.width = size.width + 'px';
                item.style.height = size.height + 'px';
                item.style.left = finalX + 'px';
                item.style.top = finalY + 'px';
                
                // 애니메이션 지연 설정
                const delay = (index * 0.1) + (Math.random() * 0.3);
                item.style.animationDelay = delay + 's';
                
                container.appendChild(item);
            });
        }
    }
}

// 미디어 아이템 생성
function createMediaItem(media, index) {
    const item = document.createElement('div');
    item.className = `media-item ${media.type}-item`;
    
    if (media.type === 'photo') {
        const img = document.createElement('img');
        // URL 인코딩을 적용하여 한글 파일명 문제 해결
        img.src = encodeURI(media.src);
        img.alt = media.title;
        img.loading = 'lazy';
        img.decoding = 'async';
        
        // 이미지 로드 실패 시 처리
        img.onerror = function() {
            console.log('이미지 로드 실패:', media.src);
            // 이미지 로드 실패 시 아이템 숨기기
            item.style.display = 'none';
            
            // 로딩 상태 확인 및 해제
            setTimeout(() => {
                const loadingElement = document.getElementById('loading');
                if (loadingElement && !loadingElement.classList.contains('hidden')) {
                    loadingElement.classList.add('hidden');
                }
            }, 1000);
        };
        
        // 이미지 로드 성공 시 회전 방지
        img.onload = function() {
            // 이미지 회전 방지
            img.style.transform = 'none';
            img.style.imageOrientation = 'from-image';
        };
        
        item.appendChild(img);
        
        // 클릭 시 확대
        item.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openImageModal(media.src, media.title);
        });
        
        // 터치 이벤트 (모바일용)
        item.addEventListener('touchstart', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openImageModal(media.src, media.title);
        }, { passive: false });
        
    } else if (media.type === 'video') {
        const video = document.createElement('video');
        // URL 인코딩을 적용하여 한글 파일명 문제 해결
        video.src = encodeURI(media.src);
        video.muted = true;
        video.loop = true;
        video.playsInline = true;
        video.preload = 'metadata';
        
        // 비디오 로드 실패 시 처리
        video.onerror = function() {
            console.log('비디오 로드 실패:', media.src);
            // 비디오 로드 실패 시 아이템을 사진으로 대체하거나 숨기기
            item.style.display = 'none';
            
            // 로딩 상태 확인 및 해제
            setTimeout(() => {
                const loadingElement = document.getElementById('loading');
                if (loadingElement && !loadingElement.classList.contains('hidden')) {
                    loadingElement.classList.add('hidden');
                }
            }, 1000);
        };
        
        // 비디오 로드 성공 시 처리
        video.onloadedmetadata = function() {
            // 비디오 로드 완료
        };
        
        item.appendChild(video);
        
        // 클릭 시 확대 모달에서 재생
        item.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openVideoModal(encodeURI(media.src), media.title);
        });
        
        // 호버 시 자동 재생 (미리보기)
        item.addEventListener('mouseenter', function() {
            video.play().then(() => {
                item.style.setProperty('--play-icon-opacity', '0');
            }).catch(error => {
                // 비디오 자동 재생 실패 시 무시
            });
        });
        
        item.addEventListener('mouseleave', function() {
            video.pause();
            item.style.setProperty('--play-icon-opacity', '1');
        });
        
        // 터치 이벤트 (모바일용) - 확대 모달에서 재생
        item.addEventListener('touchstart', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openVideoModal(encodeURI(media.src), media.title);
        }, { passive: false });
    }
    
    return item;
}

// 랜덤 크기 생성
function getRandomSize() {
    const isMobile = window.innerWidth <= 768;
    const isSmallMobile = window.innerWidth <= 480;
    
    if (isSmallMobile) {
        // 작은 모바일에서는 더 작은 크기
        const smallMobileSizes = [
            { width: 100, height: 75 },
            { width: 110, height: 80 },
            { width: 90, height: 110 },
            { width: 105, height: 85 },
            { width: 95, height: 105 }
        ];
        return smallMobileSizes[Math.floor(Math.random() * smallMobileSizes.length)];
    } else if (isMobile) {
        // 일반 모바일에서는 중간 크기
        const mobileSizes = [
            { width: 120, height: 90 },
            { width: 130, height: 95 },
            { width: 110, height: 120 },
            { width: 125, height: 100 },
            { width: 115, height: 125 }
        ];
        return mobileSizes[Math.floor(Math.random() * mobileSizes.length)];
    } else {
        // 데스크톱 크기
        const sizes = [
            { width: 200, height: 150 },
            { width: 250, height: 180 },
            { width: 300, height: 200 },
            { width: 180, height: 250 },
            { width: 220, height: 300 },
            { width: 280, height: 220 },
            { width: 320, height: 240 },
            { width: 240, height: 320 }
        ];
        return sizes[Math.floor(Math.random() * sizes.length)];
    }
}

// 이미지 확대 모달
function openImageModal(imageSrc, imageTitle) {
    const modal = document.createElement('div');
    modal.className = 'image-modal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        opacity: 0;
        transition: opacity 0.3s ease;
    `;
    
    const img = document.createElement('img');
    img.src = encodeURI(imageSrc);
    img.alt = imageTitle;
    img.style.cssText = `
        max-width: 85%;
        max-height: 85%;
        object-fit: contain;
        border-radius: 12px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
        transform: none !important;
        image-orientation: from-image;
    `;
    
    modal.appendChild(img);
    document.body.appendChild(modal);
    
    // 애니메이션 시작
    setTimeout(() => {
        modal.style.opacity = '1';
    }, 10);
    
    // 클릭 시 닫기
    modal.addEventListener('click', function() {
        modal.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(modal);
        }, 300);
    });
    
    // ESC 키로 닫기
    const closeOnEscape = function(e) {
        if (e.key === 'Escape') {
            modal.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(modal);
            }, 300);
            document.removeEventListener('keydown', closeOnEscape);
        }
    };
    document.addEventListener('keydown', closeOnEscape);
}

// 영상 확대 모달
function openVideoModal(videoSrc, videoTitle) {
    const modal = document.createElement('div');
    modal.className = 'video-modal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        opacity: 0;
        transition: opacity 0.3s ease;
    `;
    
    const videoContainer = document.createElement('div');
    videoContainer.style.cssText = `
        max-width: 85%;
        max-height: 85%;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
        position: relative;
    `;
    
    const video = document.createElement('video');
    video.src = encodeURI(videoSrc);
    video.controls = true;
    video.autoplay = true;
    video.muted = false;
    video.loop = true;
    video.playsInline = true;
    video.style.cssText = `
        width: 100%;
        height: auto;
        max-height: 90vh;
        display: block;
        background: #000;
        filter: brightness(1.2) contrast(1.1);
    `;
    
    // 비디오 로드 실패 시 처리
    video.onerror = function() {
        console.log('비디오 모달 로드 실패:', videoSrc);
        modal.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(modal);
        }, 300);
    };
    
    videoContainer.appendChild(video);
    modal.appendChild(videoContainer);
    document.body.appendChild(modal);
    
    // 애니메이션 시작
    setTimeout(() => {
        modal.style.opacity = '1';
    }, 10);
    
    // 비디오 자동 재생
    video.play().catch(error => {
        console.log('비디오 모달 자동 재생 실패:', error);
    });
    
    // 클릭 시 닫기 (비디오 영역 제외)
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            video.pause();
            modal.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(modal);
            }, 300);
        }
    });
    
    // ESC 키로 닫기
    const closeOnEscape = function(e) {
        if (e.key === 'Escape') {
            video.pause();
            modal.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(modal);
            }, 300);
            document.removeEventListener('keydown', closeOnEscape);
        }
    };
    document.addEventListener('keydown', closeOnEscape);
}

// 윈도우 리사이즈 시 미디어 재배치
window.addEventListener('resize', function() {
    const mediaContainer = document.getElementById('mediaContainer');
    const mediaItems = mediaContainer.querySelectorAll('.media-item');
    
    if (mediaItems.length > 0) {
        const containerWidth = mediaContainer.offsetWidth;
        const containerHeight = Math.max(800, window.innerHeight - 200);
        
        mediaContainer.style.height = containerHeight + 'px';
        
        // 중앙점 계산
        const centerX = containerWidth / 2;
        const centerY = containerHeight / 2;
        
        const isMobile = window.innerWidth <= 768;
        const itemCount = mediaItems.length;
        
        if (itemCount <= 8) {
            // 8개 이하: 마인드맵 스타일
            const baseRadius = isMobile ? 120 : 200;
            const maxRadius = isMobile ? 300 : 500;
            
            mediaItems.forEach((item, index) => {
                const size = getRandomSize();
                
                // 마인드맵 위치 계산 (중앙에서 방사형으로)
                const angle = (index / itemCount) * 2 * Math.PI + (Math.random() - 0.5) * 0.3;
                const radius = baseRadius + Math.random() * (maxRadius - baseRadius);
                
                // 극좌표를 직교좌표로 변환
                const x = centerX + Math.cos(angle) * radius - size.width / 2;
                const y = centerY + Math.sin(angle) * radius - size.height / 2;
                
                // 화면 경계 내에 위치하도록 조정
                const margin = 20;
                const adjustedX = Math.max(margin, Math.min(containerWidth - size.width - margin, x));
                const adjustedY = Math.max(margin, Math.min(containerHeight - size.height - margin, y));
                
                item.style.width = size.width + 'px';
                item.style.height = size.height + 'px';
                item.style.left = adjustedX + 'px';
                item.style.top = adjustedY + 'px';
            });
        } else {
            // 8개 초과: 그리드 기반 자유 배치
            const isSmallMobile = window.innerWidth <= 480;
            const cols = isSmallMobile ? 3 : (isMobile ? 4 : 6);
            const rows = Math.ceil(itemCount / cols);
            const cellWidth = (containerWidth - 40) / cols;
            const cellHeight = (containerHeight - 40) / rows;
            
            mediaItems.forEach((item, index) => {
                const size = getRandomSize();
                
                // 그리드 위치 계산
                const col = index % cols;
                const row = Math.floor(index / cols);
                
                // 셀 내에서 랜덤한 위치
                const cellX = col * cellWidth + 20;
                const cellY = row * cellHeight + 20;
                
                // 셀 내에서 랜덤 오프셋 (겹침 방지)
                const maxOffsetX = Math.max(0, cellWidth - size.width - 20);
                const maxOffsetY = Math.max(0, cellHeight - size.height - 20);
                const offsetX = Math.random() * maxOffsetX;
                const offsetY = Math.random() * maxOffsetY;
                
                const finalX = cellX + offsetX;
                const finalY = cellY + offsetY;
                
                item.style.width = size.width + 'px';
                item.style.height = size.height + 'px';
                item.style.left = finalX + 'px';
                item.style.top = finalY + 'px';
            });
        }
    }
});

// 페이지 가시성 변경 시 비디오 제어
document.addEventListener('visibilitychange', function() {
    const videos = document.querySelectorAll('video');
    
    if (document.hidden) {
        videos.forEach(video => {
            video.pause();
        });
    }
});

// 도메인별 메타 태그 설정
function updateMetaTags() {
    const currentDomain = window.location.hostname;
    const baseUrl = window.location.protocol + '//' + currentDomain;
    
    // Open Graph 이미지 URL 설정
    const ogImage = baseUrl + '/images/timeline/eum-logo.jpg?v=5';
    
    // 메타 태그 업데이트
    const ogImageMeta = document.querySelector('meta[property="og:image"]');
    const twitterImageMeta = document.querySelector('meta[name="twitter:image"]');
    const ogSecureUrlMeta = document.querySelector('meta[property="og:image:secure_url"]');
    
    // 소셜 미디어 썸네일은 e-umrogo_sum.png 사용
    if (ogImageMeta) ogImageMeta.setAttribute('content', ogImage);
    if (twitterImageMeta) twitterImageMeta.setAttribute('content', ogImage);
    if (ogSecureUrlMeta) ogSecureUrlMeta.setAttribute('content', ogImage);
    
    // 브라우저 탭 파비콘은 e-umrogo_sum.png 사용 (고정)
    const faviconLinks = document.querySelectorAll('link[rel="icon"], link[rel="apple-touch-icon"], link[rel="shortcut icon"], link[rel="mask-icon"]');
    faviconLinks.forEach(link => {
        if (link.href.includes('instarogo1.png')) {
            link.href = link.href.replace('instarogo1.png', 'e-umrogo_sum.png');
        }
    });
    
    // 사파리 전용 설정 업데이트
    const maskIcon = document.querySelector('link[rel="mask-icon"]');
    if (maskIcon) {
        maskIcon.href = baseUrl + '/images/e-umrogo_sum.png';
    }
    
    // URL 메타 태그 업데이트
    const ogUrlMeta = document.querySelector('meta[property="og:url"]');
    if (ogUrlMeta) ogUrlMeta.setAttribute('content', window.location.href);
}
