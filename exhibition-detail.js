// 전시 데이터 정의
const exhibitionData = {
    'sensory-dissolution': {
        title: 'DISSOLUTION OF SENSES: 감각해체',
        period: '2025.07.01 - 2025.07.31',
        location: '아트코리아랩 미디어월',
        description: '단체전시 기획 및 작품 제작',
        fullDescription: '단체전시 기획 및 작품 제작',
        photos: [
            '전시소개_자세히보기/감각해체/감각해체.png',
            '전시소개_자세히보기/감각해체/감각해체1.png',
            '전시소개_자세히보기/감각해체/감각해체2.png',
            '전시소개_자세히보기/감각해체/감각해체3.jpeg',
            '전시소개_자세히보기/감각해체/감각해체4.jpeg',
            '전시소개_자세히보기/감각해체/감각해체5.jpeg',
            '전시소개_자세히보기/감각해체/감각해체6.jpeg',
            '전시소개_자세히보기/감각해체/감각해체7.jpeg'
        ],
        videos: [
            '전시소개_자세히보기/감각해체/감각해체영상2.mov'
        ]
    },
    'zip': {
        title: '.zip',
        period: '2025.05.26 - 2025.05.29',
        location: '경일대학교 12호관 1F',
        description: '학기말 전시 기획 및 작품 제작',
        fullDescription: '학기말 전시 기획 및 작품 제작',
        photos: [
            '전시소개_자세히보기/zip/zip전시1.jpeg',
            '전시소개_자세히보기/zip/zip전시2.jpeg',
            '전시소개_자세히보기/zip/zip전시3.jpeg',
            '전시소개_자세히보기/zip/zip전시4.jpeg',
            '전시소개_자세히보기/zip/zip전시5.jpeg',
            '전시소개_자세히보기/zip/zip전시6.jpeg',
            '전시소개_자세히보기/zip/zip전시7.jpeg',
            '전시소개_자세히보기/zip/zip전시8.jpeg',
            '전시소개_자세히보기/zip/zip전시9.jpeg',
            '전시소개_자세히보기/zip/zip전시10.jpeg',
            '전시소개_자세히보기/zip/zip전시11.jpg',
            '전시소개_자세히보기/zip/zip전시12.JPG',
            '전시소개_자세히보기/zip/zip전시13.JPG',
            '전시소개_자세히보기/zip/zip전시14.jpeg',
            '전시소개_자세히보기/zip/zip전시15.jpeg',
            '전시소개_자세히보기/zip/zip전시16.jpg',
            '전시소개_자세히보기/zip/zip전시17.jpeg',
            '전시소개_자세히보기/zip/zip전시18.jpeg',
            '전시소개_자세히보기/zip/zip전시19.jpeg'
        ],
        videos: []
    },
    'clear-things': {
        title: '선명해져야 할 것들',
        period: '2024.12.20 - 2024.12.31',
        location: 'MOV.A(성미산로 888-11 5F)',
        description: '김다슬 교수님 전시 참여 및 작품 제작',
        fullDescription: '김다슬 교수님 전시 참여 및 작품 제작',
        photos: [
            '전시소개_자세히보기/선명해져야 할 것들/선명해져야할것들1.jpg',
            '전시소개_자세히보기/선명해져야 할 것들/선명해져야할것들2.jpg',
            '전시소개_자세히보기/선명해져야 할 것들/선명해져야할것들3.jpg',
            '전시소개_자세히보기/선명해져야 할 것들/선명해져야할것들4.jpg',
            '전시소개_자세히보기/선명해져야 할 것들/선명해져야할것들5.jpg',
            '전시소개_자세히보기/선명해져야 할 것들/선명해져야할것들6.jpg',
            '전시소개_자세히보기/선명해져야 할 것들/선명해져야할것들7.jpg',
            '전시소개_자세히보기/선명해져야 할 것들/선명해져야할것들8.jpg'
        ],
        videos: []
    },
    'sobok': {
        title: '소복',
        period: '2024.12.16 - 2024.12.20',
        location: '경일대학교 12호관 1F',
        description: '학기말 전시 기획 및 작품 제작',
        fullDescription: '학기말 전시 기획 및 작품 제작',
        photos: [
            '전시소개_자세히보기/소복/소복 사진1.jpg',
            '전시소개_자세히보기/소복/소복 사진2.jpg',
            '전시소개_자세히보기/소복/소복 사진3.jpg',
            '전시소개_자세히보기/소복/소복 사진4.jpg',
            '전시소개_자세히보기/소복/소복 사진5.jpg',
            '전시소개_자세히보기/소복/소복 사진6.jpg',
            '전시소개_자세히보기/소복/소복 사진7.jpg',
            '전시소개_자세히보기/소복/소복 사진8.jpg',
            '전시소개_자세히보기/소복/소복 사진9.jpg',
            '전시소개_자세히보기/소복/소복 사진10_edited.jpg',
            '전시소개_자세히보기/소복/소복 사진11.jpg',
            '전시소개_자세히보기/소복/소복 사진12_edited.jpg',
            '전시소개_자세히보기/소복/소복 사진13.jpg',
            '전시소개_자세히보기/소복/소복 사진14.jpg',
            '전시소개_자세히보기/소복/소복 사진15.png',
            '전시소개_자세히보기/소복/소복 사진16.png',
            '전시소개_자세히보기/소복/소복 단체사진.jpg',
            '전시소개_자세히보기/소복/소복 추가사진1.jpg',
            '전시소개_자세히보기/소복/소복 추가사진2.jpg',
            '전시소개_자세히보기/소복/소복 추가사진5.jpg'
        ],
        videos: []
    },
    'future-fragments': {
        title: '미래의 파편들',
        period: '2024.10.18 - 2024.11.10',
        location: '대구경북디자인센터 1F Media Wall',
        description: '교외 전시 작가로 참여 및 작품 제작',
        fullDescription: '교외 전시 작가로 참여 및 작품 제작',
        photos: [
            '전시소개_자세히보기/미래의 파편들/미래의파편들 사진1_edited.jpg',
            '전시소개_자세히보기/미래의 파편들/미래의파편들 사진2_edited.jpg',
            '전시소개_자세히보기/미래의 파편들/미래의파편들 사진3_edited.jpg',
            '전시소개_자세히보기/미래의 파편들/미래의파편들 사진5_edited_edited.jpg',
            '전시소개_자세히보기/미래의 파편들/미래의파편들 사진6_edited.jpg',
            '전시소개_자세히보기/미래의 파편들/미래의파편들사진7.jpg'
        ],
        videos: []
    },
    'mimyo': {
        title: '美, 묘하다',
        period: '2024.06.04 - 2024.06.10',
        location: '경일대학교 11호관 갤러리',
        description: '학기말 전시 기획 및 작품 제작',
        fullDescription: '학기말 전시 기획 및 작품 제작',
        photos: [
            '전시소개_자세히보기/미묘하다/미묘하다 사진1.jpg',
            '전시소개_자세히보기/미묘하다/미묘하다 사진2.jpg',
            '전시소개_자세히보기/미묘하다/미묘하다 사진3.jpg',
            '전시소개_자세히보기/미묘하다/미묘하다 사진4.jpg',
            '전시소개_자세히보기/미묘하다/미묘하다 사진5.jpg',
            '전시소개_자세히보기/미묘하다/미묘하다 사진6.jpg'
        ],
        videos: []
    },
    'meta-festival': {
        title: 'GYEONGBUK META CONTENTS FESTIVAL',
        period: '2024.05.31 - 2024.06.02',
        location: '대구 EXCO 동관 1F HALL 6',
        description: '메타콘텐츠 학과 대표 전시 기획 및 작품 제작',
        fullDescription: '메타콘텐츠 학과 대표 전시 기획 및 작품 제작',
        photos: [
            '전시소개_자세히보기/GYEONGBUK META CONTENTS FESTIVAL/메타콘 구도.png',
            '전시소개_자세히보기/GYEONGBUK META CONTENTS FESTIVAL/메타콘 사진1_edited.jpg',
            '전시소개_자세히보기/GYEONGBUK META CONTENTS FESTIVAL/메타콘 사진2_edited.jpg',
            '전시소개_자세히보기/GYEONGBUK META CONTENTS FESTIVAL/메타콘 사진3_edited.png',
            '전시소개_자세히보기/GYEONGBUK META CONTENTS FESTIVAL/메타콘 사진4_edited.jpg',
            '전시소개_자세히보기/GYEONGBUK META CONTENTS FESTIVAL/메타콘 사진5_edited_edited.jpg',
            '전시소개_자세히보기/GYEONGBUK META CONTENTS FESTIVAL/메타콘 작업과정_edited.png',
            '전시소개_자세히보기/GYEONGBUK META CONTENTS FESTIVAL/메타콘 작업과정2_edited.jpg'
        ],
        videos: []
    },
    'survival': {
        title: 'SURVIVAL',
        period: '2024.02.17 - 2024.02.25',
        location: '대구 중구 동덕로 30길 117 2F 아트스텔라 소노',
        description: '메타콘텐츠융합전공의 성과 보고회',
        fullDescription: '메타콘텐츠융합전공의 성과 보고회',
        photos: [
            '전시소개_자세히보기/survival/서바이벌 사진1.png',
            '전시소개_자세히보기/survival/서바이벌 사진2.png',
            '전시소개_자세히보기/survival/서바이벌 사진3.png',
            '전시소개_자세히보기/survival/서바이벌 사진4.png',
            '전시소개_자세히보기/survival/서바이벌 사진5.png',
            '전시소개_자세히보기/survival/서바이벌 사진6.png'
        ],
        videos: [
            '전시소개_자세히보기/survival/서바이벌 영상2.mp4'
        ]
    }
};

// DOM이 로드된 후 실행
document.addEventListener('DOMContentLoaded', function() {
    // URL 파라미터에서 전시 ID 가져오기
    const urlParams = new URLSearchParams(window.location.search);
    const exhibitionId = urlParams.get('id');
    
    if (exhibitionId && exhibitionData[exhibitionId]) {
        loadExhibition(exhibitionId);
    } else {
        // 기본값으로 첫 번째 전시 로드
        const firstExhibitionId = Object.keys(exhibitionData)[0];
        loadExhibition(firstExhibitionId);
    }
    
    // 뒤로가기 버튼 이벤트
    const backBtn = document.getElementById('backBtn');
    backBtn.addEventListener('click', function() {
        window.history.back();
    });
    
    // 닫기 버튼 이벤트
    const closeBtn = document.getElementById('closeBtn');
    closeBtn.addEventListener('click', function() {
        window.history.back();
    });
    
    // ESC 키로 뒤로가기
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            window.history.back();
        }
    });
});

// 전시 로드 함수
function loadExhibition(exhibitionId) {
    const data = exhibitionData[exhibitionId];
    if (!data) return;
    
    // 헤더 정보 설정
    document.getElementById('exhibitionTitle').textContent = data.title;
    document.getElementById('exhibitionPeriod').textContent = data.period;
    document.getElementById('exhibitionLocation').textContent = data.location;
    
    // 전시 상세 설명 설정
    const descriptionElement = document.getElementById('exhibitionDescription');
    if (data.fullDescription) {
        descriptionElement.textContent = data.fullDescription;
        descriptionElement.style.display = 'block';
    } else {
        descriptionElement.style.display = 'none';
    }
    
    // 미디어 컨테이너 초기화
    const mediaContainer = document.getElementById('mediaContainer');
    mediaContainer.innerHTML = '';
    
    // 모든 미디어 파일을 하나의 배열로 합치기
    const allMedia = [];
    
    // 사진 추가
    data.photos.forEach(photo => {
        allMedia.push({
            type: 'photo',
            src: photo,
            title: data.title
        });
    });
    
    // 영상 추가
    data.videos.forEach(video => {
        allMedia.push({
            type: 'video',
            src: video,
            title: data.title
        });
    });
    
    // 미디어 순서를 랜덤하게 섞기
    shuffleArray(allMedia);
    
    // 미디어 아이템 생성 및 배치
    createMediaItems(allMedia, mediaContainer);
    
    // 로딩 숨기기
    setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
    }, 1000);
}

// 배열을 랜덤하게 섞는 함수
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

// 미디어 아이템 생성 및 배치 (마인드맵 스타일)
function createMediaItems(mediaArray, container) {
    const containerWidth = container.offsetWidth;
    const containerHeight = Math.max(800, window.innerHeight - 200);
    
    // 컨테이너 높이 설정
    container.style.height = containerHeight + 'px';
    
    // 중앙점 계산
    const centerX = containerWidth / 2;
    const centerY = containerHeight / 2;
    
    // 마인드맵 배치를 위한 설정
    const isMobile = window.innerWidth <= 768;
    const baseRadius = isMobile ? 120 : 200; // 기본 반지름
    const maxRadius = isMobile ? 300 : 500; // 최대 반지름
    
    // 미디어 아이템들을 마인드맵 형태로 배치
    mediaArray.forEach((media, index) => {
        const item = createMediaItem(media, index);
        
        // 랜덤한 크기 설정
        const size = getRandomSize();
        
        // 마인드맵 위치 계산 (중앙에서 방사형으로)
        const angle = (index / mediaArray.length) * 2 * Math.PI + (Math.random() - 0.5) * 0.5; // 약간의 랜덤성 추가
        const radius = baseRadius + Math.random() * (maxRadius - baseRadius);
        
        // 극좌표를 직교좌표로 변환
        const x = centerX + Math.cos(angle) * radius - size.width / 2;
        const y = centerY + Math.sin(angle) * radius - size.height / 2;
        
        // 화면 경계 내에 위치하도록 조정
        const margin = 20;
        const adjustedX = Math.max(margin, Math.min(containerWidth - size.width - margin, x));
        const adjustedY = Math.max(margin, Math.min(containerHeight - size.height - margin, y));
        
        // 아이템 스타일 설정
        item.style.width = size.width + 'px';
        item.style.height = size.height + 'px';
        item.style.left = adjustedX + 'px';
        item.style.top = adjustedY + 'px';
        
        // 애니메이션 지연 설정 (중앙에서 바깥쪽으로)
        const distanceFromCenter = Math.sqrt((adjustedX - centerX) ** 2 + (adjustedY - centerY) ** 2);
        const maxDistance = Math.sqrt((containerWidth / 2) ** 2 + (containerHeight / 2) ** 2);
        const delay = (distanceFromCenter / maxDistance) * 0.5 + (index * 0.05);
        item.style.animationDelay = delay + 's';
        
        container.appendChild(item);
    });
}

// 미디어 아이템 생성
function createMediaItem(media, index) {
    const item = document.createElement('div');
    item.className = `media-item ${media.type}-item`;
    
    if (media.type === 'photo') {
        const img = document.createElement('img');
        img.src = media.src;
        img.alt = media.title;
        img.loading = 'lazy';
        
        // 이미지 로드 실패 시 처리
        img.onerror = function() {
            item.style.display = 'none';
        };
        
        item.appendChild(img);
        
        // 클릭 시 확대
        item.addEventListener('click', function() {
            openImageModal(media.src, media.title);
        });
        
    } else if (media.type === 'video') {
        const video = document.createElement('video');
        video.src = media.src;
        video.muted = true;
        video.loop = true;
        video.playsInline = true;
        video.preload = 'metadata';
        
        // 비디오 로드 실패 시 처리
        video.onerror = function() {
            console.log('비디오 로드 실패:', media.src);
            item.style.display = 'none';
        };
        
        // 비디오 로드 성공 시 처리
        video.onloadedmetadata = function() {
            console.log('비디오 로드 성공:', media.src);
        };
        
        item.appendChild(video);
        
        // 클릭 시 확대 모달에서 재생
        item.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openVideoModal(media.src, media.title);
        });
        
        // 호버 시 자동 재생 (미리보기)
        item.addEventListener('mouseenter', function() {
            video.play().then(() => {
                item.style.setProperty('--play-icon-opacity', '0');
            }).catch(error => {
                console.log('비디오 자동 재생 실패:', error);
            });
        });
        
        item.addEventListener('mouseleave', function() {
            video.pause();
            item.style.setProperty('--play-icon-opacity', '1');
        });
        
        // 터치 이벤트 (모바일용) - 확대 모달에서 재생
        item.addEventListener('touchstart', function(e) {
            e.preventDefault();
            openVideoModal(media.src, media.title);
        });
    }
    
    return item;
}

// 랜덤 크기 생성
function getRandomSize() {
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
        // 모바일에서는 더 작은 크기
        const mobileSizes = [
            { width: 120, height: 90 },
            { width: 140, height: 100 },
            { width: 100, height: 140 },
            { width: 130, height: 110 },
            { width: 110, height: 130 }
        ];
        return mobileSizes[Math.floor(Math.random() * mobileSizes.length)];
    } else {
        // 데스크톱 크기
        const sizes = [
            { width: 200, height: 150 },
            { width: 250, height: 180 },
            { width: 300, height: 200 },
            { width: 180, height: 250 },
            { width: 220, height: 300 },
            { width: 280, height: 220 },
            { width: 320, height: 240 },
            { width: 240, height: 320 }
        ];
        return sizes[Math.floor(Math.random() * sizes.length)];
    }
}



// 이미지 확대 모달
function openImageModal(imageSrc, imageTitle) {
    const modal = document.createElement('div');
    modal.className = 'image-modal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        opacity: 0;
        transition: opacity 0.3s ease;
    `;
    
    const img = document.createElement('img');
    img.src = imageSrc;
    img.alt = imageTitle;
    img.style.cssText = `
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    `;
    
    modal.appendChild(img);
    document.body.appendChild(modal);
    
    // 애니메이션 시작
    setTimeout(() => {
        modal.style.opacity = '1';
    }, 10);
    
    // 클릭 시 닫기
    modal.addEventListener('click', function() {
        modal.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(modal);
        }, 300);
    });
    
    // ESC 키로 닫기
    const closeOnEscape = function(e) {
        if (e.key === 'Escape') {
            modal.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(modal);
            }, 300);
            document.removeEventListener('keydown', closeOnEscape);
        }
    };
    document.addEventListener('keydown', closeOnEscape);
}

// 영상 확대 모달
function openVideoModal(videoSrc, videoTitle) {
    const modal = document.createElement('div');
    modal.className = 'video-modal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        opacity: 0;
        transition: opacity 0.3s ease;
    `;
    
    const videoContainer = document.createElement('div');
    videoContainer.style.cssText = `
        max-width: 90%;
        max-height: 90%;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        position: relative;
    `;
    
    const video = document.createElement('video');
    video.src = videoSrc;
    video.controls = true;
    video.autoplay = true;
    video.muted = false;
    video.loop = true;
    video.playsInline = true;
    video.style.cssText = `
        width: 100%;
        height: auto;
        max-height: 90vh;
        display: block;
        background: #000;
        filter: brightness(1.2) contrast(1.1);
    `;
    
    // 비디오 로드 실패 시 처리
    video.onerror = function() {
        console.log('비디오 모달 로드 실패:', videoSrc);
        modal.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(modal);
        }, 300);
    };
    
    videoContainer.appendChild(video);
    modal.appendChild(videoContainer);
    document.body.appendChild(modal);
    
    // 애니메이션 시작
    setTimeout(() => {
        modal.style.opacity = '1';
    }, 10);
    
    // 비디오 자동 재생
    video.play().catch(error => {
        console.log('비디오 모달 자동 재생 실패:', error);
    });
    
    // 클릭 시 닫기 (비디오 영역 제외)
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            video.pause();
            modal.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(modal);
            }, 300);
        }
    });
    
    // ESC 키로 닫기
    const closeOnEscape = function(e) {
        if (e.key === 'Escape') {
            video.pause();
            modal.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(modal);
            }, 300);
            document.removeEventListener('keydown', closeOnEscape);
        }
    };
    document.addEventListener('keydown', closeOnEscape);
}

// 윈도우 리사이즈 시 미디어 재배치 (마인드맵 스타일)
window.addEventListener('resize', function() {
    const mediaContainer = document.getElementById('mediaContainer');
    const mediaItems = mediaContainer.querySelectorAll('.media-item');
    
    if (mediaItems.length > 0) {
        const containerWidth = mediaContainer.offsetWidth;
        const containerHeight = Math.max(800, window.innerHeight - 200);
        
        mediaContainer.style.height = containerHeight + 'px';
        
        // 중앙점 계산
        const centerX = containerWidth / 2;
        const centerY = containerHeight / 2;
        
        // 마인드맵 배치를 위한 설정
        const isMobile = window.innerWidth <= 768;
        const baseRadius = isMobile ? 120 : 200;
        const maxRadius = isMobile ? 300 : 500;
        
        mediaItems.forEach((item, index) => {
            // 랜덤한 크기 설정
            const size = getRandomSize();
            
            // 마인드맵 위치 계산 (중앙에서 방사형으로)
            const angle = (index / mediaItems.length) * 2 * Math.PI + (Math.random() - 0.5) * 0.5;
            const radius = baseRadius + Math.random() * (maxRadius - baseRadius);
            
            // 극좌표를 직교좌표로 변환
            const x = centerX + Math.cos(angle) * radius - size.width / 2;
            const y = centerY + Math.sin(angle) * radius - size.height / 2;
            
            // 화면 경계 내에 위치하도록 조정
            const margin = 20;
            const adjustedX = Math.max(margin, Math.min(containerWidth - size.width - margin, x));
            const adjustedY = Math.max(margin, Math.min(containerHeight - size.height - margin, y));
            
            item.style.width = size.width + 'px';
            item.style.height = size.height + 'px';
            item.style.left = adjustedX + 'px';
            item.style.top = adjustedY + 'px';
        });
    }
});

// 페이지 가시성 변경 시 비디오 제어
document.addEventListener('visibilitychange', function() {
    const videos = document.querySelectorAll('video');
    
    if (document.hidden) {
        videos.forEach(video => {
            video.pause();
        });
    }
});
